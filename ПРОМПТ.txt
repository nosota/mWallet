Внимательно прочти документ с тестами TEST_PLAN.md.
Разработай тесты из раздела "6. Escrow Tests".
Если какой-то тест невозможно реализовать при помощи текущего API, то спрашивай.
Пиши тесты только через контроллер.
Для тестов из раздела создай соответствующий класс в test/java/com.nosota.mwallet.tests который наследуется от TestBase.
Тести интеграционные и используют MockMvc и testcontainers.
Не нужно подгонять тесты под неверно написанную систему! Если нужно исправить систему, то спрашивай и
предлагай варианты исправления. Обдумывай каждый тест критически.
Если будешь исправлять контроллеры, то думай внимательно как это может повлиять на все другие тесты и не забывай их справлять.
Все ли понятно? Задавай уточняющие вопросы.

ЗАМЕЧАНИЕ: Как сделать так, чтобы операции пополнения кошельков из вне или вывод во вне не рушили proper double-entry?
DEPOSIT: Создаёшь специальный "системный" баланс, который представляет внешний мир — банки, payment processors, cash.
Он уходит в минус при депозитах, и это корректно — деньги "пришли извне".
WITHDRAW: Тот же системный баланс получает деньги обратно при выводе. Его минус уменьшается — деньги "ушли наружу".
ИТОГ: Сумма всех балансов в системе всегда равна нулю. External World показывает сколько реальных денег должно быть на корр. счетах.
