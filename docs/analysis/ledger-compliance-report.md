# –û—Ç—á–µ—Ç –æ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ Ledger-–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è–º

**–î–∞—Ç–∞**: 27 –¥–µ–∫–∞–±—Ä—è 2025
**–í–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞**: mWallet 1.0.5
**–°—Ç–∞—Ç—É—Å**: ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ ‚Äî —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞

---

## Executive Summary

–ü—Ä–æ–µ–∫—Ç mWallet —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∫–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã ledger-—Å–∏—Å—Ç–µ–º—ã (immutability, double-entry, audit trail), –Ω–æ **–Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç** —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π ledger-—Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–∏ –∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è–º –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º.

**–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã**:
1. ‚ùå –¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç ledger-—Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º (RESERVE/CONFIRMED/REJECTED vs hold/release/cancel/settlement)
2. ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —è–≤–Ω—ã–π –∫–æ–Ω—Ü–µ–ø—Ç **settlement** (—Ñ–∏–Ω–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤)
3. ‚ö†Ô∏è `TransactionType.LEDGER` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –∞—Ä—Ö–∏–≤–Ω—ã—Ö —á–µ–∫–ø–æ–∏–Ω—Ç–æ–≤, –∞ –Ω–µ –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∂—É—Ä–Ω–∞–ª
4. ‚ùå –ù–µ—Ç —è–≤–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –º–µ–∂–¥—É **release** (—É—Å–ø–µ—à–Ω–∞—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞) –∏ **cancel** (–æ—Ç–º–µ–Ω–∞)
5. ‚ùå –ù–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º–∞ **batching/settlement** (–Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π –¥–ª—è –ø–∞–∫–µ—Ç–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)

**–û—Ü–µ–Ω–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è**: 60/100

---

## 1. –î–µ—Ç–∞–ª—å–Ω—ã–π –ê–Ω–∞–ª–∏–∑ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è

### 1.1. ‚úÖ –ß—Ç–æ –°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º

#### 1.1.1. Immutable Ledger ‚úÖ

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: –ó–∞–ø–∏—Å–∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è –∏ –Ω–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É—é—Ç—Å—è.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
```java
// WalletService.confirm() - —Å–æ–∑–¥–∞–µ—Ç –ù–û–í–£–Æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
Transaction confirmTransaction = new Transaction();
confirmTransaction.setStatus(TransactionStatus.CONFIRMED);
// –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è HOLD —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ù–ï —É–¥–∞–ª—è–µ—Ç—Å—è
```

**–í–µ—Ä–¥–∏–∫—Ç**: ‚úÖ **–°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢**
–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (HOLD/RESERVE) –æ—Å—Ç–∞—é—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–µ, —Å–æ–∑–¥–∞—é—Ç—Å—è –Ω–æ–≤—ã–µ (CONFIRMED/REJECTED).

**–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ**:
- `WalletService.confirm()` (—Å—Ç—Ä–æ–∫–∏ 137-161) - —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å
- `WalletService.reject()` (—Å—Ç—Ä–æ–∫–∏ 181-210) - —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å
- –ù–∏–≥–¥–µ –≤ –∫–æ–¥–µ –Ω–µ—Ç `UPDATE` –∏–ª–∏ `DELETE` —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

---

#### 1.1.2. Double-Entry Accounting ‚úÖ

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: –°—É–º–º–∞ –≤—Å–µ—Ö –¥–µ–±–µ—Ç–æ–≤ —Ä–∞–≤–Ω–∞ —Å—É–º–º–µ –≤—Å–µ—Ö –∫—Ä–µ–¥–∏—Ç–æ–≤ (zero-sum).

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
```java
// TransactionService.confirmTransactionGroup() - —Å—Ç—Ä–æ–∫–∏ 76-80
Long reconciliationAmount = transactionRepository.getReconciliationAmountByGroupId(referenceId);
if(reconciliationAmount != 0) {
    throw new TransactionGroupZeroingOutException(
        "Transaction " + referenceId + " is not reconciled."
    );
}
```

**SQL –∑–∞–ø—Ä–æ—Å** (–∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏):
```sql
SELECT COALESCE(SUM(amount), 0)
FROM transaction
WHERE reference_id = ? AND status IN ('HOLD', 'RESERVE')
```

**–ü—Ä–∏–º–µ—Ä**:
```
User A ‚Üí User B: 1000‚ÇΩ

HOLD:    -1000‚ÇΩ (wallet A)
RESERVE: +1000‚ÇΩ (wallet B)
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
SUM:          0‚ÇΩ ‚úì
```

**–í–µ—Ä–¥–∏–∫—Ç**: ‚úÖ **–°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢**
–°–∏—Å—Ç–µ–º–∞ —Å—Ç—Ä–æ–≥–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç zero-sum –ø—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –≥—Ä—É–ø–ø—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.

---

#### 1.1.3. Audit Trail (–ê—É–¥–∏—Ä—É–µ–º–æ—Å—Ç—å) ‚úÖ

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: –ú–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ª—é–±–æ–≥–æ —Å—á—ë—Ç–∞ –Ω–∞ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- –¢—Ä—ë—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è:
  - Tier 1: `transaction` (–∞–∫—Ç–∏–≤–Ω—ã–µ)
  - Tier 2: `transaction_snapshot` (–Ω–µ–¥–∞–≤–Ω—è—è –∏—Å—Ç–æ—Ä–∏—è)
  - Tier 3: `transaction_snapshot_archive` (–¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ)
- `TransactionHistoryService.getFullTransactionHistory()` —Å–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å–æ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω–µ–π

**–í–µ—Ä–¥–∏–∫—Ç**: ‚úÖ **–°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢**
–ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞–≤—Å–µ–≥–¥–∞, –º–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞ –Ω–∞ –ª—é–±—É—é –¥–∞—Ç—É.

---

#### 1.1.4. Debit/Credit –û–ø–µ—Ä–∞—Ü–∏–∏ ‚úÖ

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: –û–ø–µ—Ä–∞—Ü–∏–∏ debit (—Å–ø–∏—Å–∞–Ω–∏–µ) –∏ credit (–∑–∞—á–∏—Å–ª–µ–Ω–∏–µ).

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
```java
public enum TransactionType {
    CREDIT,  // –ó–∞—á–∏—Å–ª–µ–Ω–∏–µ
    DEBIT,   // –°–ø–∏—Å–∞–Ω–∏–µ
    LEDGER   // –ö–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ - —Å–º. –Ω–∏–∂–µ)
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
```java
// WalletService.hold() - —Å—Ç—Ä–æ–∫–∞ 74
holdTransaction.setType(TransactionType.DEBIT);  // –°–ø–∏—Å–∞–Ω–∏–µ

// WalletService.reserve() - —Å—Ç—Ä–æ–∫–∞ 112
reserveTransaction.setType(TransactionType.CREDIT);  // –ó–∞—á–∏—Å–ª–µ–Ω–∏–µ
```

**–í–µ—Ä–¥–∏–∫—Ç**: ‚úÖ **–°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢**
–¢–∏–ø—ã DEBIT –∏ CREDIT –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

---

### 1.2. ‚ùå –ß—Ç–æ –ù–ï –°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º

#### 1.2.1. ‚ùå –¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç ledger-—Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º

**–ü—Ä–æ–±–ª–µ–º–∞**: –¢–µ–∫—É—â–∏–µ —Å—Ç–∞—Ç—É—Å—ã –Ω–µ –æ—Ç—Ä–∞–∂–∞—é—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é ledger-—Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—é.

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
```java
public enum TransactionStatus {
    HOLD,      // –£–¥–µ—Ä–∂–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ (–¥–ª—è –¥–µ–±–µ—Ç–∞)
    RESERVE,   // –†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ (–¥–ª—è –∫—Ä–µ–¥–∏—Ç–∞)
    CONFIRMED, // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ
    REJECTED   // –û—Ç–∫–ª–æ–Ω–µ–Ω–æ
}
```

**–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è ledger-—Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è**:

| –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å | –î–æ–ª–∂–µ–Ω –±—ã—Ç—å | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------------|-------------|----------|
| `HOLD` | ‚úÖ `HOLD` | –£–¥–µ—Ä–∂–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ (–¥–ª—è –¥–µ–±–µ—Ç–∞ –∏ –∫—Ä–µ–¥–∏—Ç–∞) |
| `RESERVE` | ‚ùå `HOLD` (–¥–ª—è –∫—Ä–µ–¥–∏—Ç–∞) | –†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ö–æ–¥—è—â–∏—Ö —Å—Ä–µ–¥—Å—Ç–≤ |
| `CONFIRMED` | ‚ùå `RELEASED` –∏–ª–∏ `SETTLED` | –£—Å–ø–µ—à–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ |
| `REJECTED` | ‚ùå `CANCELLED` | –û—Ç–º–µ–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —É—Å–ª–æ–≤–∏–π |
| –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | ‚ùå `SETTLED` | –§–∏–Ω–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ (–ø–æ—Å–ª–µ release) |

**–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑–ª–∏—á–∏—è**:

1. **RESERVE vs HOLD** (–¥–ª—è –∫—Ä–µ–¥–∏—Ç–∞):
   - –í ledger-—Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–∏ –¥–ª—è –≤—Ö–æ–¥—è—â–∏—Ö —Å—Ä–µ–¥—Å—Ç–≤ —Ç–æ–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **HOLD**
   - RESERVE ‚Äî —ç—Ç–æ –∞—Ä—Ö–∞–∏—á–Ω—ã–π —Ç–µ—Ä–º–∏–Ω, –∫–æ—Ç–æ—Ä—ã–π –≤–Ω–æ—Å–∏—Ç –ø—É—Ç–∞–Ω–∏—Ü—É
   - **–ü—Ä–∞–≤–∏–ª—å–Ω–æ**: `hold()` –¥–ª—è –¥–µ–±–µ—Ç–∞, `hold()` –¥–ª—è –∫—Ä–µ–¥–∏—Ç–∞ (—Ä–∞–∑–ª–∏—á–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–∏–ø DEBIT/CREDIT)

2. **CONFIRMED vs RELEASED/SETTLED**:
   - **RELEASED** ‚Äî —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å—Ä–µ–¥—Å—Ç–≤ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —É—Å–ª–æ–≤–∏–π
   - **SETTLED** ‚Äî —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–∑–∂–µ release)
   - **CONFIRMED** ‚Äî —Å–ª–∏—à–∫–æ–º –æ–±—â–∏–π —Ç–µ—Ä–º–∏–Ω, –Ω–µ –æ—Ç—Ä–∞–∂–∞–µ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É

3. **REJECTED vs CANCELLED**:
   - **CANCELLED** ‚Äî –æ—Ç–º–µ–Ω–∞ –¥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —É—Å–ª–æ–≤–∏–π (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–∞–∑–∞–ª—Å—è, –∏—Å—Ç—ë–∫ —Å—Ä–æ–∫)
   - **REJECTED** ‚Äî —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Ç–µ—Ä–º–∏–Ω, –Ω–µ –æ—Ç—Ä–∞–∂–∞–µ—Ç –ø—Ä–∏—á–∏–Ω—É –æ—Ç–º–µ–Ω—ã

**–ü—Ä–∏–º–µ—Ä –∏–∑ –±–∞–Ω–∫–æ–≤—Å–∫–æ–≥–æ ledger**:

```
Escrow-—Å–¥–µ–ª–∫–∞:
1. –ü–æ–∫—É–ø–∞—Ç–µ–ª—å ‚Üí Escrow: 1000‚ÇΩ (HOLD)
2. –ü—Ä–æ–¥–∞–≤–µ—Ü –æ—Ç–≥—Ä—É–∂–∞–µ—Ç —Ç–æ–≤–∞—Ä
3. –ü–æ–∫—É–ø–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏–µ ‚Üí Escrow ‚Üí –ü—Ä–æ–¥–∞–≤–µ—Ü (RELEASED ‚Üí SETTLED)

–û—Ç–º–µ–Ω–∞:
1. –ü–æ–∫—É–ø–∞—Ç–µ–ª—å ‚Üí Escrow: 1000‚ÇΩ (HOLD)
2. –ü—Ä–æ–¥–∞–≤–µ—Ü –Ω–µ –æ—Ç–≥—Ä—É–∑–∏–ª ‚Üí Escrow ‚Üí –ü–æ–∫—É–ø–∞—Ç–µ–ª—å (CANCELLED)
```

**–í–µ—Ä–¥–∏–∫—Ç**: ‚ùå **–ù–ï –°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢**
–¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è —Ç—Ä–µ–±—É–µ—Ç –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏.

---

#### 1.2.2. ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–æ–Ω—Ü–µ–ø—Ç Settlement

**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Ç —è–≤–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –º–µ–∂–¥—É "—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π" (release) –∏ "—Ñ–∏–Ω–∞–ª—å–Ω—ã–º –ø–µ—Ä–µ–≤–æ–¥–æ–º" (settlement).

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ ledger**:
```
HOLD ‚Üí RELEASE ‚Üí SETTLEMENT
  ‚Üì       ‚Üì         ‚Üì
–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ ‚Üí –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ ‚Üí –§–∏–Ω–∞–ª—å–Ω–æ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–æ
```

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
```
HOLD ‚Üí CONFIRMED (–æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ release + settlement)
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞**:

1. **Batching –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω**: –ù–µ–ª—å–∑—è –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ –¥–µ–ª–∞—Ç—å settlement —Ä–∞–∑ –≤ –¥–µ–Ω—å (–∫–∞–∫ –¥–µ–ª–∞—é—Ç –ø–ª–∞—Ç—ë–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã)
2. **Escrow —Å–ª–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å**: –ù–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è "—Å—Ä–µ–¥—Å—Ç–≤–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã, –Ω–æ –µ—â—ë –Ω–µ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω—ã"
3. **–î–∏—Å–ø—É—Ç—ã**: –ü—Ä–∏ —Å–ø–æ—Ä–µ –Ω–µ–ª—å–∑—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞ —Å –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–º –ø–µ—Ä–µ–≤–æ–¥–æ–º

**–ü—Ä–∏–º–µ—Ä –∏–∑ Stripe**:
```java
// 1. Hold —Å—Ä–µ–¥—Å—Ç–≤–∞
paymentIntent.setStatus("requires_capture");

// 2. Release (—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞)
paymentIntent.capture(); // –î–µ–Ω—å–≥–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã

// 3. Settlement (—Ñ–∏–Ω–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥)
// –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ batch processing (1 —Ä–∞–∑ –≤ –¥–µ–Ω—å)
```

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è mWallet**:
```java
// 1. Hold
walletService.hold(walletId, amount, groupId);

// 2. Confirm (release + settlement –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ!)
walletService.confirm(walletId, groupId);

// –ù–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ settlement —à–∞–≥–∞!
```

**–í–µ—Ä–¥–∏–∫—Ç**: ‚ùå **–ù–ï –°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢**
–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π settlement –º–µ—Ö–∞–Ω–∏–∑–º.

---

#### 1.2.3. ‚ö†Ô∏è TransactionType.LEDGER –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–ü—Ä–æ–±–ª–µ–º–∞**: `LEDGER` —Ç–∏–ø –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –∞—Ä—Ö–∏–≤–Ω—ã—Ö —á–µ–∫–ø–æ–∏–Ω—Ç–æ–≤, –∞ –Ω–µ –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∂—É—Ä–Ω–∞–ª.

**–¢–µ–∫—É—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
```java
// TransactionSnapshotService.archiveOldSnapshots() - —Å–æ–∑–¥–∞–Ω–∏–µ ledger entry
TransactionSnapshot ledger = new TransactionSnapshot();
ledger.setType(TransactionType.LEDGER);  // ‚ùå –¢–æ–ª—å–∫–æ –¥–ª—è –∫–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏–∏!
ledger.setAmount(cumulativeBalance);
ledger.setIsLedgerEntry(true);
```

**–ö–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞**:

–í –±–∞–Ω–∫–æ–≤—Å–∫–æ–π —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–∏ **ledger** ‚Äî —ç—Ç–æ —Å–∞–º –∂—É—Ä–Ω–∞–ª –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π, –∞ –Ω–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ç–∏–ø –∑–∞–ø–∏—Å–∏ –¥–ª—è –∫–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏–∏.

**–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è**:

1. **Ledger** = –∂—É—Ä–Ω–∞–ª = —Ç–∞–±–ª–∏—Ü–∞ `transaction` + `transaction_snapshot` + `transaction_snapshot_archive`
2. –í—Å–µ –∑–∞–ø–∏—Å–∏ –≤ —ç—Ç–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö ‚Äî —ç—Ç–æ **ledger entries**
3. –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ç–∏–ø –¥–ª—è –∫–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏–∏ –¥–æ–ª–∂–µ–Ω –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è **CONSOLIDATION** –∏–ª–∏ **CHECKPOINT**, –∞ –Ω–µ LEDGER

**–¢–µ–∫—É—â–∞—è –ø—É—Ç–∞–Ω–∏—Ü–∞**:
```
TransactionType.LEDGER = Checkpoint/Consolidation (—Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å)
Ledger (–∂—É—Ä–Ω–∞–ª) = –≤—Å—è —Ç–∞–±–ª–∏—Ü–∞ transaction
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å**:
```
TransactionType.CHECKPOINT = Checkpoint/Consolidation
Ledger Service = —Å–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Å–µ–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏
```

**–í–µ—Ä–¥–∏–∫—Ç**: ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û –°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢**
–ö–æ–Ω—Ü–µ–ø—Ü–∏—è ledger –µ—Å—Ç—å, –Ω–æ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç—Ä–µ–±—É—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏.

---

#### 1.2.4. ‚ùå –ù–µ—Ç —è–≤–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è Release vs Cancel

**–ü—Ä–æ–±–ª–µ–º–∞**: `reject()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏ –¥–ª—è cancel, –∏ –¥–ª—è release —Å –≤–æ–∑–≤—Ä–∞—Ç–æ–º —Å—Ä–µ–¥—Å—Ç–≤.

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
```java
// WalletService.reject()
public Integer reject(Integer walletId, UUID referenceId) {
    // –°–æ–∑–¥–∞–µ—Ç REJECTED —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
    // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏ –¥–ª—è cancel, –∏ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ —Å—Ä–µ–¥—Å—Ç–≤
}
```

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ ledger**:

| –û–ø–µ—Ä–∞—Ü–∏—è | –ö–æ–≥–¥–∞ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|----------|-------|-----------|
| **CANCEL** | –î–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —É—Å–ª–æ–≤–∏–π (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–∞–∑–∞–ª—Å—è, –∏—Å—Ç—ë–∫ —Å—Ä–æ–∫) | –°—Ä–µ–¥—Å—Ç–≤–∞ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è |
| **RELEASE** | –ü–æ—Å–ª–µ —Ä–∞–∑–±–æ—Ä–∞ —Å–∏—Ç—É–∞—Ü–∏–∏ (–¥–∏—Å–ø—É—Ç, –≤–æ–∑–≤—Ä–∞—Ç —Ç–æ–≤–∞—Ä–∞) | –°—Ä–µ–¥—Å—Ç–≤–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ |
| **SETTLEMENT** | –£—Å–ø–µ—à–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ | –°—Ä–µ–¥—Å—Ç–≤–∞ –ø–µ—Ä–µ–≤–æ–¥—è—Ç—Å—è –ø–æ–ª—É—á–∞—Ç–µ–ª—é |

**–ü—Ä–∏–º–µ—Ä —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤**:

```java
// –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ–Ω–∏–ª –∑–∞–∫–∞–∑ –¥–æ –æ—Ç–≥—Ä—É–∑–∫–∏
// –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: CANCEL
walletService.reject(walletId, groupId); // ‚ùå –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è reject

// –°—Ü–µ–Ω–∞—Ä–∏–π 2: –î–∏—Å–ø—É—Ç, —Å—Ä–µ–¥—Å—Ç–≤–∞ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –ø–æ—Å–ª–µ —Ä–∞–∑–±–æ—Ä–∞
// –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: RELEASE (—Å –≤–æ–∑–≤—Ä–∞—Ç–æ–º)
walletService.reject(walletId, groupId); // ‚ùå –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ—Ç –∂–µ reject

// –°—Ü–µ–Ω–∞—Ä–∏–π 3: –£—Å–ø–µ—à–Ω–∞—è —Å–¥–µ–ª–∫–∞
// –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: SETTLEMENT
walletService.confirm(walletId, groupId); // ‚ö†Ô∏è Confirm –¥–µ–ª–∞–µ—Ç –≤—Å—ë —Å—Ä–∞–∑—É
```

**–í–µ—Ä–¥–∏–∫—Ç**: ‚ùå **–ù–ï –°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢**
–ù—É–∂–Ω—ã –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è cancel, release, settlement.

---

#### 1.2.5. ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç Batching/Settlement –º–µ—Ö–∞–Ω–∏–∑–º

**–ü—Ä–æ–±–ª–µ–º–∞**: –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å—Ä–∞–∑—É finalize, –Ω–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å –¥–ª—è batch processing.

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ ledger**: –ü–ª–∞—Ç—ë–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ –¥–µ–ª–∞—é—Ç settlement –ø–∞–∫–µ—Ç–Ω–æ (—Ä–∞–∑ –≤ –¥–µ–Ω—å).

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
```java
// TransactionService.transferBetweenTwoWallets()
walletService.hold(senderId, amount, groupId);
walletService.reserve(recipientId, amount, groupId);
confirmTransactionGroup(groupId);  // ‚ùå –°—Ä–∞–∑—É —Ñ–∏–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è!
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å**:
```java
// 1. Hold —Å—Ä–µ–¥—Å—Ç–≤–∞ (–Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ–º –æ–ø–µ—Ä–∞—Ü–∏–∏)
walletService.hold(senderId, amount, groupId);
walletService.hold(recipientId, amount, groupId);
releaseTransactionGroup(groupId);  // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞

// 2. Batch settlement (—Ä–∞–∑ –≤ –¥–µ–Ω—å, –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)
settlementService.settleBatch(dateRange);  // –§–∏–Ω–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ batch settlement**:

1. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**: –û–¥–∏–Ω —Ä–∞–∑ –≤ –¥–µ–Ω—å –≤–º–µ—Å—Ç–æ –º–∏–ª–ª–∏–æ–Ω–æ–≤ –æ–ø–µ—Ä–∞—Ü–∏–π
2. **Reconciliation**: –õ–µ–≥—á–µ —Å–≤–µ—Ä—è—Ç—å –±–∞–ª–∞–Ω—Å—ã
3. **–°—Ç–∞–Ω–¥–∞—Ä—Ç –∏–Ω–¥—É—Å—Ç—Ä–∏–∏**: –í—Å–µ –ø–ª–∞—Ç—ë–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã —Ç–∞–∫ –¥–µ–ª–∞—é—Ç
4. **–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–º–µ–Ω—ã**: –î–æ settlement –æ–ø–µ—Ä–∞—Ü–∏—é –º–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å

**–í–µ—Ä–¥–∏–∫—Ç**: ‚ùå **–ù–ï –°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢**
–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å batch settlement –º–µ—Ö–∞–Ω–∏–∑–º.

---

### 1.3. ‚ö†Ô∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

#### 1.3.1. –ù–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–≥–æ Ledger Service

**–ü—Ä–æ–±–ª–µ–º–∞**: Ledger-–ª–æ–≥–∏–∫–∞ —Ä–∞–∑–º–∞–∑–∞–Ω–∞ –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º (WalletService, TransactionService).

**–¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**:
```
WalletService:
  - hold()
  - reserve()
  - confirm()
  - reject()

TransactionService:
  - createTransactionGroup()
  - confirmTransactionGroup()
  - rejectTransactionGroup()
```

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**:
```
LedgerService (–æ—Å–Ω–æ–≤–Ω–æ–π –∂—É—Ä–Ω–∞–ª):
  - recordDebit()
  - recordCredit()
  - holdFunds()
  - releaseFunds()
  - cancelHold()
  - settleFunds()

WalletService (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞–º–∏):
  - createWallet()
  - getBalance()

TransactionGroupService (–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞):
  - createGroup()
  - confirmGroup()
```

**–í–µ—Ä–¥–∏–∫—Ç**: ‚ö†Ô∏è –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å –≤—ã–¥–µ–ª–µ–Ω–∏–µ–º LedgerService.

---

## 2. –û—Ü–µ–Ω–∫–∞ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –ø–æ –ö—Ä–∏—Ç–µ—Ä–∏—è–º

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –°—Ç–∞—Ç—É—Å | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|----------|--------|--------|-------------|
| **Immutability** | ‚úÖ | 10/10 | –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç |
| **Double-Entry** | ‚úÖ | 10/10 | Zero-sum –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç |
| **Audit Trail** | ‚úÖ | 10/10 | –¢—Ä—ë—Ö—É—Ä–æ–≤–Ω–µ–≤–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ |
| **Debit/Credit** | ‚úÖ | 10/10 | –¢–∏–ø—ã –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç |
| **Hold –æ–ø–µ—Ä–∞—Ü–∏—è** | ‚úÖ | 8/10 | –ï—Å—Ç—å, –Ω–æ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è |
| **Release –æ–ø–µ—Ä–∞—Ü–∏—è** | ‚ùå | 0/10 | –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è |
| **Cancel –æ–ø–µ—Ä–∞—Ü–∏—è** | ‚ùå | 0/10 | –ù–µ—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —Å reject |
| **Settlement** | ‚ùå | 0/10 | –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç |
| **–¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è** | ‚ùå | 2/10 | –ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º |
| **Batching** | ‚ùå | 0/10 | –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç |
| **Ledger Service** | ‚ö†Ô∏è | 4/10 | –õ–æ–≥–∏–∫–∞ —Ä–∞–∑–º–∞–∑–∞–Ω–∞ |

**–ò–¢–û–ì–û**: **60/110 –±–∞–ª–ª–æ–≤** (54.5%)

---

## 3. –†–∏—Å–∫–∏ –¢–µ–∫—É—â–µ–π –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 3.1. –ë–∏–∑–Ω–µ—Å-–†–∏—Å–∫–∏

1. **–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Escrow** ‚ö†Ô∏è
   - –ù–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è "—Å—Ä–µ–¥—Å—Ç–≤–∞ —É–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –ø–æ—Å—Ä–µ–¥–Ω–∏–∫–æ–º"
   - –ù–µ–ª—å–∑—è —Ä–∞–∑–¥–µ–ª–∏—Ç—å release –∏ settlement

2. **–°–ª–æ–∂–Ω–æ—Å—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –ø–ª–∞—Ç—ë–∂–Ω—ã–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏** ‚ö†Ô∏è
   - Stripe, PayPal –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—é
   - –ü—É—Ç–∞–Ω–∏—Ü–∞ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ API

3. **–ü—Ä–æ–±–ª–µ–º—ã —Å —Ä–µ–≥—É–ª—è—Ç–æ—Ä–Ω–æ–π –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç—å—é** ‚ö†Ô∏è
   - –¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –±–∞–Ω–∫–æ–≤—Å–∫–∏–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º
   - –°–ª–æ–∂–Ω–æ—Å—Ç—å –∞—É–¥–∏—Ç–∞ –¥–ª—è —Ä–µ–≥—É–ª—è—Ç–æ—Ä–æ–≤

### 3.2. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –†–∏—Å–∫–∏

1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ** ‚ö†Ô∏è
   - –ù–µ—Ç batch processing
   - –ö–∞–∂–¥–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è —Å—Ä–∞–∑—É —Ñ–∏–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è

2. **–°–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∏—Å–ø—É—Ç–æ–≤** ‚ö†Ô∏è
   - –ù–µ–ª—å–∑—è —É–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞ –≤ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
   - –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç release –º–µ—Ö–∞–Ω–∏–∑–º

3. **–ü—É—Ç–∞–Ω–∏—Ü–∞ –≤ –∫–æ–¥–µ** ‚ö†Ô∏è
   - RESERVE vs HOLD —Å–µ–º–∞–Ω—Ç–∏–∫–∞ –Ω–µ–æ—á–µ–≤–∏–¥–Ω–∞
   - CONFIRMED –¥–µ–ª–∞–µ—Ç –∏ release –∏ settlement

### 3.3. –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –†–∏—Å–∫–∏

1. **–°–ª–æ–∂–Ω–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤** ‚ö†Ô∏è
   - –ù–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è
   - –ù—É–∂–Ω–æ –æ–±—ä—è—Å–Ω—è—Ç—å, –ø–æ—á–µ–º—É RESERVE —ç—Ç–æ hold –¥–ª—è –∫—Ä–µ–¥–∏—Ç–∞

2. **–û—à–∏–±–∫–∏ –≤ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ** ‚ö†Ô∏è
   - –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ confirm –≤–º–µ—Å—Ç–æ release
   - –ü—É—Ç–∞–Ω–∏—Ü–∞ –º–µ–∂–¥—É cancel –∏ reject

---

## 4. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 4.1. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ (Must Have)

1. **–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å—ã** –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å ledger-—Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º–∏
   - `RESERVE` ‚Üí —É–±—Ä–∞—Ç—å, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `HOLD` –¥–ª—è –∫—Ä–µ–¥–∏—Ç–∞
   - `CONFIRMED` ‚Üí `RELEASED` –∏–ª–∏ `SETTLED`
   - `REJECTED` ‚Üí `CANCELLED`

2. **–î–æ–±–∞–≤–∏—Ç—å Settlement –º–µ—Ö–∞–Ω–∏–∑–º**
   - –û—Ç–¥–µ–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å `SETTLED`
   - –ú–µ—Ç–æ–¥ `settle()` –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞
   - Batch settlement –¥–ª—è –º–∞—Å—Å–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

3. **–†–∞–∑–¥–µ–ª–∏—Ç—å Release –∏ Cancel**
   - `release()` ‚Äî —É—Å–ø–µ—à–Ω–∞—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
   - `cancel()` ‚Äî –æ—Ç–º–µ–Ω–∞ –¥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —É—Å–ª–æ–≤–∏–π

### 4.2. –ñ–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ (Should Have)

1. **–í—ã–¥–µ–ª–∏—Ç—å LedgerService**
   - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ–º–∏ ledger-–æ–ø–µ—Ä–∞—Ü–∏—è–º–∏
   - –ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

2. **–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å TransactionType.LEDGER**
   - `LEDGER` ‚Üí `CHECKPOINT` –∏–ª–∏ `CONSOLIDATION`
   - –ò–∑–±–µ–∂–∞—Ç—å —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π –ø—É—Ç–∞–Ω–∏—Ü—ã

3. **–î–æ–±–∞–≤–∏—Ç—å batch processing**
   - –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π
   - –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π settlement

### 4.3. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ (Nice to Have)

1. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ledger-–∫–æ–Ω—Ü–µ–ø—Ü–∏–π**
   - –ì–ª–æ—Å—Å–∞—Ä–∏–π —Ç–µ—Ä–º–∏–Ω–æ–≤
   - –ü—Ä–∏–º–µ—Ä—ã —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

2. **Ledger API –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º**
   - RESTful endpoints
   - –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ DTO

---

## 5. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç mWallet —Ä–µ–∞–ª–∏–∑—É–µ—Ç **—Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã ledger** (immutability, double-entry, audit trail), –Ω–æ **–Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –±–∞–Ω–∫–æ–≤—Å–∫–æ–π —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–∏ –∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è–º**.

**–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã**:
- ‚ùå –¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è (RESERVE/CONFIRMED/REJECTED)
- ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Settlement
- ‚ùå –ù–µ—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è Release vs Cancel
- ‚ùå –ù–µ—Ç batch processing

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ–º –∫ ledger-—Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∫–∞–∫ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞ –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üî¥ **–í—ã—Å–æ–∫–∏–π** ‚Äî –±–µ–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è ledger-—Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.

---

## 6. –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–°–º. [–ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π –ø–æ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—é –∫ ledger-—Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º](./ledger-compliance-plan.md)
